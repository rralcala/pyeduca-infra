/*
	// License block \\
	
	   *   @filename:          js.js
	   *   @date:              May 18th, 2009

	   *   Copyright (C) 2007-2008 mustafa
	   *   This program is free software; you can redistribute it and/or modify it under the terms of the 
	   *   GNU General Public License as published by the Free Software Foundation. See gpl-3.0.txt
	   
	\\ License block //
*/
function $(a){return document.getElementById(a)}var CPLanguages,popup,fOp,edit,upload;CPLanguages={csharp:"C#",css:"CSS",generic:"Generic",html:"HTML",java:"Java",javascript:"JavaScript",perl:"Perl",ruby:"Ruby",php:"PHP",text:"Text",sql:"SQL",vbscript:"VBScript"};function ajax(a,e,c,b){json2markup(["div",{attributes:{id:"ajaxOverlay"}},"img",{attributes:{src:"pafm/images/ajax.gif",id:"ajaxImg",title:"Loading",alt:"Loading"}}],document.body);$("ajaxOverlay").style.height=document.body.offsetHeight+"px";fade($("ajaxOverlay"),0,6,25,"in");var d=window.ActiveXObject?new ActiveXObject("MSXML2.XMLHTTP.3.0"):new XMLHttpRequest();d.open(e,a,true);d.onreadystatechange=function(){if(d.readyState!=4){return}fade($("ajaxOverlay"),6,0,25,"out",function(){document.body.removeChild($("ajaxOverlay"));document.body.removeChild($("ajaxImg"))});if(d.status==200||d.statusText=="OK"){if(d.responseText=="Please refresh the page and login"){alert("Please refresh the page and login")}else{b(d.responseText)}}else{alert("AJAX request unsuccessful.\nStatus Code: "+d.status+"\nStatus Text: "+d.statusText+"\nParameters: "+a)}d=null};if(e.toLowerCase()=="post"){d.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8")}d.send(c)}function json2markup(c,g){var b=0,a=c.length,d,f,e;for(;b<a;b++){if(c[b].constructor==Array){json2markup(c[b],d)}else{if(c[b].constructor==Object){if(c[b].attributes){for(f in c[b].attributes){f.toLowerCase()=="style"?d.style.cssText=c[b].attributes[f]:f.toLowerCase()=="class"?d.className=c[b].attributes[f]:f.toLowerCase()=="for"?d.htmlFor=c[b].attributes[f]:d.setAttribute(f,c[b].attributes[f])}}if(c[b].events){for(e in c[b].events){d.addEventListener?d.addEventListener(e,c[b].events[e],false):d.attachEvent("on"+e,c[b].events[e])}}if(c[b].preText){g.appendChild(document.createTextNode(c[b].preText))}if(c[b].text){d.appendChild(document.createTextNode(c[b].text))}g.appendChild(d);if(c[b].postText){g.appendChild(document.createTextNode(c[b].postText))}}else{d=document.createElement(c[b])}}}}function fade(e,f,g,c,h,i){var d=e.style.opacity!=undefined,b,a;e.style[d?"opacity":"filter"]=d?f/10:"alpha(opacity="+f*10+")";a=setInterval(function(){if(h=="in"){f++;b=f<=g}else{if(h=="out"){f--;b=f>=g}}if(b){e.style[d?"opacity":"filter"]=d?f/10:"alpha(opacity="+f*10+")"}else{clearInterval(a);if(i){i()}}},c)}popup={init:function(e,b){json2markup(["div",{attributes:{id:"popOverlay"},events:{click:popup.close}}],document.body);json2markup(["div",{attributes:{id:"popup"}},["div",{attributes:{id:"head"}},["a",{attributes:{id:"x",href:"#"},events:{click:function(g){popup.close();g.preventDefault?g.preventDefault():g.returnValue=false}},text:"[x]"},"span",{text:e}],"div",{attributes:{id:"body"}}]],document.body);var f=$("popup"),d=$("popOverlay"),a=$("x"),c;if(window.ActiveXObject){a.style.cssFloat="none";a.style.position="absolute";a.style.right=a.parentNode.offsetLeft+3}json2markup(b,$("body"));if(c=$("moveListUL")){if(c.offsetHeight>(document.body.offsetHeight-150)){c.style.height=document.body.offsetHeight-150+"px"}}f.style.marginTop="-"+parseInt(f.offsetHeight)/2+"px";f.style.marginLeft="-"+parseInt(f.offsetWidth)/2+"px";fade(d,0,6,25,"in");document.onkeydown=function(g){if((g||window.event).keyCode==27){popup.close();return false}}},close:function(){if($("popup")){var a=$("popOverlay");fade(a,6,0,25,"out",function(){document.body.removeChild(a)});document.body.removeChild($("popup"))}document.onkeydown=null}};fOp={rename:function(a,b){popup.init("Rename:",["form",{attributes:{action:"?do=rename&subject="+a+"&path="+b,method:"post"}},["input",{attributes:{title:"Rename To",type:"text",name:"rename",value:a}},"input",{attributes:{title:"Ok",type:"submit",value:"\u2713"}}]])},create:function(a,b){popup.init("Create "+a+":",["form",{attributes:{method:"post",action:"?do=create&path="+b}},["input",{attributes:{title:"Filename",type:"text",name:a}},"input",{attributes:{title:"Ok",type:"submit",value:"\u2713"}}]])},chmod:function(c,b,a){popup.init("Chmod "+unescape(b)+":",["form",{attributes:{method:"post",action:"?do=chmod&subject="+b+"&path="+c}},["input",{attributes:{title:"chmod",type:"text",name:"mod",value:a}},"input",{attributes:{title:"Ok",type:"submit",value:"\u2713"}}]])},moveList:function(a,b,c){ajax(("?do=moveList&subject="+a+"&path="+b+"&to="+c),"get",null,function(e){if(!$("popup")){popup.init("Move "+unescape(a)+" to:",Function("return "+e)())}else{var g=$("popup"),d=$("x"),f;$("body").innerHTML="";json2markup(Function("return "+e)(),$("body"));if(window.ActiveXObject){d.style.right=d.parentNode.offsetLeft+3}if((f=$("moveListUL")).offsetHeight>(document.body.offsetHeight-150)){f.style.height=document.body.offsetHeight-150+"px"}g.style.marginTop="-"+parseInt(g.offsetHeight)/2+"px";g.style.marginLeft="-"+parseInt(g.offsetWidth)/2+"px"}})}};edit={init:function(c,g,a){var d=[],b,f,e;a=a||"text";switch(a){case"js":a="javascript";break;case"htm":a="html";break;case"pl":a="perl";break;case"rb":a="ruby"}json2markup(["div",{attributes:{id:"editOverlay"}}],document.body);$("editOverlay").style.height=document.body.offsetHeight+"px";json2markup(["div",{attributes:{id:"ea"}},["textarea",{attributes:{id:"ta","class":"codepress "+a,rows:"30",cols:"90"}},"br",{},"input",{attributes:{type:"text",value:unescape(c),readonly:""}},"input",{attributes:{type:"button",value:"Save",id:"save"},events:{click:function(){edit.save(c,g)}}},"input",{attributes:{type:"button",value:"Exit",id:"exit"},events:{click:function(){edit.exit(c,g)}}},"input",{attributes:{type:"button",value:"Toggle CodePress"},events:{click:function(){ta.toggleEditor()}}},"select",{attributes:{id:"ll",style:"margin-left: 1px;"},events:{change:function(i){var h=i.srcElement||i.target;ta.setLanguage(h[h.selectedIndex].value)}}},["option",{text:"Loading"}],"span",{attributes:{id:"editMsg"}}]],document.body);document.onkeydown=function(h){if((h||window.event).keyCode==27){edit.exit(c,g);return false}};for(b in CPLanguages){e={attributes:{value:b},text:CPLanguages[b]};if(a==b){e.attributes.selected="true"}d.push("option",e)}(f=$("ll")).innerHTML="";json2markup(d,f);ajax("?do=readFile&path="+g+"&subject="+c,"get",null,function(h){$("ta").value=h;if(!$("cpjs")){json2markup(["script",{attributes:{src:"pafm/codepress/codepress.js",type:"text/javascript",id:"cpjs"},events:{load:function(){if(!/webkit/.test(navigator.userAgent.toLowerCase())){CodePress.run()}}}}],document.getElementsByTagName("head")[0]);$("cpjs").onreadystatechange=function(){if(this.readyState=="complete"){CodePress.run()}}}else{CodePress.run()}})},save:function(b,c){$("editMsg").innerHTML=null;var a="data="+encodeURIComponent(window.ta?ta.getCode():$("ta").value);ajax("?do=saveEdit&subject="+b+"&path="+c,"post",a,function(d){$("editMsg").className=d!="Saved"?"failed":"succeeded";$("editMsg").innerHTML=d});window.__FILESAVED=true},exit:function(a,b){if(window.__FILESAVED){ajax("?do=getfs&path="+b+"&subject="+a,"get",null,function(e){var g=$("dirList").getElementsByTagName("li"),d=unescape(a),f=0,c=g.length;for(;f<c;f++){if(g[f].title==d){g[f].getElementsByTagName("span")[0].innerHTML=e;break}}})}document.body.removeChild($("ea"));document.body.removeChild($("editOverlay"));window.__FILESAVED=null;document.onkeydown=null}};upload={init:function(b,a){popup.init("Upload:",["form",{attributes:{id:"upload",action:"?do=upload&path="+b,method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"}},["input",{attributes:{type:"hidden",name:"MAX_FILE_SIZE",value:a}},"input",{attributes:{type:"file",name:"file"},events:{change:function(c){$("rc").innerHTML="";upload.chk((c.srcElement||c.target).value,b)}}},"span",{attributes:{id:"rc"}}]])},chk:function(c,d){var b=c.split(/\\|\//g),a;b=b.push?b[b.length-1]:b;ajax("?do=fileExists&path="+d+"&subject="+b,"get",null,function(e){if(e=="1"){a=["br",{},"b",{text:"File exists, overwrite?"},"br",{},"input",{attributes:{type:"submit",value:"Yes"}},"input",{attributes:{type:"button",id:"tb",value:"No"},events:{click:popup.close}}]}else{a=["input",{attributes:{title:"Ok",type:"submit",value:"\u2713",id:"uploadOk"}}]}json2markup(a,$("rc"))})}};